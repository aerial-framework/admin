<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" xmlns:pages="pages.*"
			creationComplete="init()" width="800" height="600" showStatusBar="false" verticalGap="0" horizontalAlign="right" xmlns:viewStackEffects="org.efflex.mx.viewStackEffects.*" xmlns:pairViewStackEffects="org.efflex.mx.pairViewStackEffects.*">
	
	<mx:HBox width="100%" verticalAlign="middle">
		<mx:Image source="@Embed(source='assets/images/aerial-logo.png')">
			<mx:filters>
				<mx:GlowFilter alpha="0.5" blurX="12" blurY="6" color="#000000" quality="3" strength="3"/>
			</mx:filters>
		</mx:Image>
		
		<mx:Spacer width="100%"/>
		
		<mx:Button icon="@Embed(source='assets/icons/dusseldorf/home.png')" paddingLeft="8" paddingRight="8" paddingTop="8" paddingBottom="8"
				   click="appControl.showPage.dispatch(ApplicationController.HOME)"/>
		<mx:Button icon="@Embed(source='assets/icons/dusseldorf/current-work.png')" paddingLeft="8" paddingRight="8" paddingTop="8" paddingBottom="8"/>
		<mx:Button icon="@Embed(source='assets/icons/dusseldorf/config.png')" paddingLeft="8" paddingRight="8" paddingTop="8" paddingBottom="8"/>
		<mx:Label id="versionStr" fontSize="12" fontWeight="bold" color="#DDDDDD" visible="false" includeInLayout="false"/>
	</mx:HBox>
	<mx:Spacer height="12"/>
	
	<mx:Panel width="100%" height="100%" headerHeight="0" paddingTop="12">		
		<mx:ViewStack id="pagesVS" width="100%" height="100%">
			<mx:VBox horizontalAlign="center" verticalAlign="middle" showEffect="{fadeEffect}">
				<mx:HBox horizontalGap="20" verticalAlign="middle">
					<mx:Button icon="@Embed(source='assets/icons/dusseldorf/plus.png')" height="75"
							   labelPlacement="bottom" label="New Project" width="135"
							   click="appControl.showPage.dispatch(ApplicationController.NEW_PROJECT)"/>
					<mx:VRule height="100%"/>
					<mx:Button icon="@Embed(source='assets/icons/dusseldorf/current-work.png')" height="75"
							   labelPlacement="bottom" label="Open Recent Project" width="135"
							   click="appControl.showPage.dispatch(ApplicationController.OPEN_PROJECT)"/>
					<mx:VRule height="100%"/>
					<mx:Button icon="@Embed(source='assets/icons/dusseldorf/graphic-design.png')" height="75"
							   labelPlacement="bottom" label="Open Project" width="135"
							   click="appControl.showPage.dispatch(ApplicationController.BROWSE_FOR_PROJECT)"/>
				</mx:HBox>
			</mx:VBox>
			<pages:ArchiveView id="newProject" width="100%" height="100%" label="Start a new Project" showEffect="{fadeEffect}"/>
			<pages:ProjectBrowser id="projectBrowser" width="100%" height="100%" label="Manage Installation" showEffect="{fadeEffect}"/>
			<pages:ProjectView id="projectView" width="100%" height="100%" label="Manage Installation" showEffect="{fadeEffect}"/>
			<pages:ConfigEditor id="configEditor" width="100%" height="100%" showEffect="{fadeEffect}"/>
			<pages:CodeGeneration id="codeGeneration" width="100%" height="100%" showEffect="{fadeEffect}"/>
			<pages:BackupAndRestore id="backAndRestore" width="100%" height="100%" showEffect="{fadeEffect}"/>
		</mx:ViewStack>
	</mx:Panel>
	
	<viewStackEffects:Fade id="fadeEffect" duration="500" transparent="true"/>
	
	<mx:Spacer height="6"/>
	
	<mx:HBox width="100%">
		<mx:LinkButton label="http://aerial-project.org" click="navigateToURL(new URLRequest('http://aerial-project.org'))"
					   buttonMode="true" color="#DDDDDD"/>
		<mx:Spacer width="100%"/>
		<mx:Button icon="@Embed(source='assets/icons/dusseldorf/consulting-16.png')" height="25" width="28"/>
	</mx:HBox>
	
	
	<mx:Script>
		<![CDATA[	
			import air.update.ApplicationUpdaterUI;
			import air.update.events.UpdateEvent;
			
			import controllers.ApplicationController;
			
			import mx.controls.Alert;
			import mx.utils.ObjectUtil;
			
			private var appControl:ApplicationController = ApplicationController.instance;
			
			private var appUpdater:ApplicationUpdaterUI = new ApplicationUpdaterUI();
			
			private function init():void
			{
				setApplicationVersion();

				appUpdater.updateURL = "http://aerial-project.org/app-version.xml";
				appUpdater.addEventListener(UpdateEvent.INITIALIZED, onUpdate);
				appUpdater.addEventListener(ErrorEvent.ERROR, onError);				
				
				appUpdater.isCheckForUpdateVisible = false;
				appUpdater.isFileUpdateVisible = false;
				appUpdater.isInstallUpdateVisible = false;
				
				appUpdater.initialize();
				
				appControl.showPage.add(showPageHandler);
			}
			
			private function showPageHandler(page:String):void
			{
				switch(page)
				{
					case ApplicationController.HOME:
						pagesVS.selectedIndex = 0;
						break;
					case ApplicationController.NEW_PROJECT:
						pagesVS.selectedChild = newProject;
						break;
					case ApplicationController.BROWSE_FOR_PROJECT:
						pagesVS.selectedChild = projectBrowser;
						break;
					case ApplicationController.OPEN_PROJECT:
						pagesVS.selectedChild = projectView;
						break;
					case ApplicationController.CODE_GENERATION:
						pagesVS.selectedChild = codeGeneration;
						break;
					case ApplicationController.CONFIG_EDITOR:
						pagesVS.selectedChild = configEditor;
						break;
					case ApplicationController.BACKUP_AND_RESTORE:
						pagesVS.selectedChild = backAndRestore;
						break;
				}
			}
			
			private function setApplicationVersion():void
			{
				var appXML:XML = NativeApplication.nativeApplication.applicationDescriptor;
				var ns:Namespace = appXML.namespace();
				versionStr.text = "Version " + appXML.ns::version;
			}
			
			private function onUpdate(event:UpdateEvent):void
			{
				appUpdater.checkNow();
			}
			
			private function onError(event:ErrorEvent):void
			{
				Alert.show(event.toString());
			}
		]]>
	</mx:Script>
	
	<mx:Style source="assets/styles/undefined/style.css"/>
</mx:WindowedApplication>